<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arm-2D: How To Accelerate Arm-2D</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="arm.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Arm-2D
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown(this);
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">2D Image Processing Library for Cortex-M Processors</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_how_to_accelerate_arm_2d.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How To Accelerate Arm-2D </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Arm-2D provides several standard ways to add support for the hardware acceleration of your target platform. Those methods address the typical 2D accelerations that are available in the ecosystem. Arm-2D categorizes them into several topics:</p>
<ul>
<li>Accelerations that are <b>Tightly Coupled with Software Algorithm</b>. This is also known as <b>Synchronouse</b> Acceleration.</li>
<li>Accelerations <b>Asynchronousely</b> via dedicated Processing Element (PE).<ul>
<li>2D-Capable-DMA, for example: DMAC-350, DMA2D</li>
<li>2D GPUs</li>
<li>Processors are dedicated for running 2D processing tasks</li>
</ul>
</li>
<li>Acceleration via <b>Arm Custom Instruction (ACI)</b></li>
</ul>
<p >Depending on the capability of the target platform, the acceleration methods might exist simultaneously, for example, a dual-core Cortex-M55 system with Helium and ACI extensions, using DMAC-350 to accelerate some 2D operations. In other words, the aforementioned acceleration methods are not mutually exclusive. You can apply and enable them to arm-2d if available.</p>
<blockquote class="doxtable">
<p ><b>NOTE</b>:</p>
<ol type="1">
<li>When Helium is available, and one enables the Helium support during the compilation, Arm-2D detects the Helium and turns on the Helium acceleration automatically.</li>
<li>This document is for system/application engineers who design drivers to add various accelerations to Arm-2D for a target hardware platform. </li>
</ol>
</blockquote>
<h1><a class="anchor" id="autotoc_md136"></a>
1 Software Tightly Coupled (Synchronouse) Acceleration</h1>
<h2><a class="anchor" id="autotoc_md137"></a>
1.1 Acceleration via Arm-2D Intrinsics</h2>
<p >Arm-2D uses some Arm-2D specific Intrinsics in the default low-level C implementations. These intrinsics are defined as macros in the private header file <code>__arm_2d_impl.h</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_INIT</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_INIT</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_GRAY8</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_GRAY8(__SRC_ADDR, __DES_ADDR, __TRANS)       \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwOPA = 256 - (__TRANS);                               \</span></div>
<div class="line"><span class="preprocessor">                const uint8_t *pchSrc = (uint8_t *)(__SRC_ADDR);                \</span></div>
<div class="line"><span class="preprocessor">                uint8_t *pchDes = (uint8_t *)(__DES_ADDR);                      \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                *pchDes = ((uint16_t)( ((uint16_t)(*pchSrc++) * hwOPA)          \</span></div>
<div class="line"><span class="preprocessor">                                     + ((uint16_t)(*pchDes) * (__TRANS))        \</span></div>
<div class="line"><span class="preprocessor">                                     ) &gt;&gt; 8);                                   \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_RGB565</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_RGB565(__SRC_ADDR, __DES_ADDR, __TRANS)      \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwOPA = 256 - (__TRANS);                               \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_color_fast_rgb_t tSrcPix, tTargetPix;                  \</span></div>
<div class="line"><span class="preprocessor">                uint16_t *phwTargetPixel = (__DES_ADDR);                        \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_rgb565_unpack(*(__SRC_ADDR), &amp;tSrcPix);                \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_rgb565_unpack(*phwTargetPixel, &amp;tTargetPix);           \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                for (int i = 0; i &lt; 3; i++) {                                   \</span></div>
<div class="line"><span class="preprocessor">                    uint16_t        hwTemp =                                    \</span></div>
<div class="line"><span class="preprocessor">                        (uint16_t) (tSrcPix.BGRA[i] * hwOPA) +                  \</span></div>
<div class="line"><span class="preprocessor">                        (tTargetPix.BGRA[i] * (__TRANS));                       \</span></div>
<div class="line"><span class="preprocessor">                    tTargetPix.BGRA[i] = (uint16_t) (hwTemp &gt;&gt; 8);              \</span></div>
<div class="line"><span class="preprocessor">                }                                                               \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                </span><span class="comment">/* pack merged stream */</span><span class="preprocessor">                                        \</span></div>
<div class="line"><span class="preprocessor">                *phwTargetPixel = __arm_2d_rgb565_pack(&amp;tTargetPix);            \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_CCCN888</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_CCCN888(__SRC_ADDR, __DES_ADDR, __TRANS)     \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwOPA = 256 - (__TRANS);                               \</span></div>
<div class="line"><span class="preprocessor">                </span><span class="comment">/* do not change alpha */</span><span class="preprocessor">                                       \</span></div>
<div class="line"><span class="preprocessor">                uint_fast8_t ARM_2D_SAFE_NAME(n) = sizeof(uint32_t) - 1;        \</span></div>
<div class="line"><span class="preprocessor">                const uint8_t *pchSrc = (uint8_t *)(__SRC_ADDR);                \</span></div>
<div class="line"><span class="preprocessor">                uint8_t *pchDes = (uint8_t *)(__DES_ADDR);                      \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                do {                                                            \</span></div>
<div class="line"><span class="preprocessor">                    *pchDes = ( ((uint_fast16_t)(*pchSrc++) * hwOPA)            \</span></div>
<div class="line"><span class="preprocessor">                              + ((uint_fast16_t)(*pchDes) * (__TRANS))          \</span></div>
<div class="line"><span class="preprocessor">                              ) &gt;&gt; 8;                                           \</span></div>
<div class="line"><span class="preprocessor">                     pchDes++;                                                  \</span></div>
<div class="line"><span class="preprocessor">                } while(--ARM_2D_SAFE_NAME(n));                                 \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_OPA_GRAY8</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_OPA_GRAY8(__SRC_ADDR, __DES_ADDR, __OPA)     \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwTrans = 256 - (__OPA);                               \</span></div>
<div class="line"><span class="preprocessor">                const uint8_t *pchSrc = (uint8_t *)(__SRC_ADDR);                \</span></div>
<div class="line"><span class="preprocessor">                uint8_t *pchDes = (uint8_t *)(__DES_ADDR);                      \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                *pchDes = ((uint16_t)( ((uint16_t)(*pchSrc++) * (__OPA))        \</span></div>
<div class="line"><span class="preprocessor">                                     + ((uint16_t)(*pchDes) * hwTrans)          \</span></div>
<div class="line"><span class="preprocessor">                                     ) &gt;&gt; 8);                                   \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_OPA_RGB565</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_OPA_RGB565(__SRC_ADDR, __DES_ADDR, __OPA)    \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwTrans = 256 - (__OPA);                               \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_color_fast_rgb_t tSrcPix, tTargetPix;                  \</span></div>
<div class="line"><span class="preprocessor">                uint16_t *phwTargetPixel = (__DES_ADDR);                        \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_rgb565_unpack(*(__SRC_ADDR), &amp;tSrcPix);                \</span></div>
<div class="line"><span class="preprocessor">                __arm_2d_rgb565_unpack(*phwTargetPixel, &amp;tTargetPix);           \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                for (int i = 0; i &lt; 3; i++) {                                   \</span></div>
<div class="line"><span class="preprocessor">                    uint16_t        hwTemp =                                    \</span></div>
<div class="line"><span class="preprocessor">                        (uint16_t) (tSrcPix.BGRA[i] * (__OPA)) +                \</span></div>
<div class="line"><span class="preprocessor">                        (tTargetPix.BGRA[i] * hwTrans);                         \</span></div>
<div class="line"><span class="preprocessor">                    tTargetPix.BGRA[i] = (uint16_t) (hwTemp &gt;&gt; 8);              \</span></div>
<div class="line"><span class="preprocessor">                }                                                               \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                </span><span class="comment">/* pack merged stream */</span><span class="preprocessor">                                        \</span></div>
<div class="line"><span class="preprocessor">                *phwTargetPixel = __arm_2d_rgb565_pack(&amp;tTargetPix);            \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_BLENDING_OPA_CCCN888</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_BLENDING_OPA_CCCN888(__SRC_ADDR, __DES_ADDR, __OPA)   \</span></div>
<div class="line"><span class="preprocessor">            do {                                                                \</span></div>
<div class="line"><span class="preprocessor">                uint16_t hwTrans = 256 - (__OPA);                               \</span></div>
<div class="line"><span class="preprocessor">                </span><span class="comment">/* do not change alpha */</span><span class="preprocessor">                                       \</span></div>
<div class="line"><span class="preprocessor">                uint_fast8_t ARM_2D_SAFE_NAME(n) = sizeof(uint32_t) - 1;        \</span></div>
<div class="line"><span class="preprocessor">                const uint8_t *pchSrc = (uint8_t *)(__SRC_ADDR);                \</span></div>
<div class="line"><span class="preprocessor">                uint8_t *pchDes = (uint8_t *)(__DES_ADDR);                      \</span></div>
<div class="line"><span class="preprocessor">                                                                                \</span></div>
<div class="line"><span class="preprocessor">                do {                                                            \</span></div>
<div class="line"><span class="preprocessor">                    *pchDes = ( ((uint_fast16_t)(*pchSrc++) * (__OPA))          \</span></div>
<div class="line"><span class="preprocessor">                              + ((uint_fast16_t)(*pchDes) * hwTrans)            \</span></div>
<div class="line"><span class="preprocessor">                              ) &gt;&gt; 8;                                           \</span></div>
<div class="line"><span class="preprocessor">                     pchDes++;                                                  \</span></div>
<div class="line"><span class="preprocessor">                } while(--ARM_2D_SAFE_NAME(n));                                 \</span></div>
<div class="line"><span class="preprocessor">            } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_AVERAGE_RGB565</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_AVERAGE_RGB565(__PIXEL_IN, __ALPHA)                   \</span></div>
<div class="line"><span class="preprocessor">    do {                                                                        \</span></div>
<div class="line"><span class="preprocessor">        __arm_2d_color_fast_rgb_t tTempColour;                                  \</span></div>
<div class="line"><span class="preprocessor">        __arm_2d_rgb565_unpack((__PIXEL_IN), &amp;tTempColour);                     \</span></div>
<div class="line"><span class="preprocessor">        tPixel.R += tTempColour.R * (__ALPHA);                                  \</span></div>
<div class="line"><span class="preprocessor">        tPixel.G += tTempColour.G * (__ALPHA);                                  \</span></div>
<div class="line"><span class="preprocessor">        tPixel.B += tTempColour.B * (__ALPHA);                                  \</span></div>
<div class="line"><span class="preprocessor">    } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_AVERAGE_CCCN888</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_AVERAGE_CCCN888(__PIXEL_IN, __ALPHA)                  \</span></div>
<div class="line"><span class="preprocessor">    do {                                                                        \</span></div>
<div class="line"><span class="preprocessor">        arm_2d_color_rgb888_t tTempColour = {.tValue = (__PIXEL_IN)};           \</span></div>
<div class="line"><span class="preprocessor">        tPixel.R += tTempColour.u8R * (__ALPHA);                                \</span></div>
<div class="line"><span class="preprocessor">        tPixel.G += tTempColour.u8G * (__ALPHA);                                \</span></div>
<div class="line"><span class="preprocessor">        tPixel.B += tTempColour.u8B * (__ALPHA);                                \</span></div>
<div class="line"><span class="preprocessor">    } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __ARM_2D_PIXEL_AVERAGE_GRAY8</span></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_PIXEL_AVERAGE_GRAY8(__PIXEL_IN, __ALPHA)                    \</span></div>
<div class="line"><span class="preprocessor">    do {                                                                        \</span></div>
<div class="line"><span class="preprocessor">        tPixel += (uint16_t)(__PIXEL_IN) * (uint16_t)(__ALPHA);                 \</span></div>
<div class="line"><span class="preprocessor">    } while(0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><blockquote class="doxtable">
<p >NOTE: Arm-2D will call <code>__ARM_2D_PIXEL_BLENDING_INIT</code> <b>every time</b> before running the low-level implementation. </p>
</blockquote>
<p>As shown above, you can override the default definition and implement with your own acceleration. Depends on the toolchain and the way of compilation, different ways of overriding the Arm-2D intrinsics are available:</p>
<ul>
<li>* Creating a header file called <code>arm_2d_user_sync_acc.h</code>, adding your definition in the header file and defining the macro <code>__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</code> to <code>1</code> (in <code>arm_2d_cfg.h</code> or <code>-D</code> option). (<b>This is the recommended method.</b>)</li>
<li>Using <code>-D</code> in command line.</li>
<li>Providing your own definition in a header file and pre-including it in the compilation (for example, via <code>-include</code> option in GCC, LLVM and Arm Compiler 6).</li>
</ul>
<h2><a class="anchor" id="autotoc_md138"></a>
1.2 Overriding the Default Low-Level Implementations</h2>
<p >Arm-2D provides the default C implementations for a set of 2D operations. Although these functions are seperated in different c source files, the prototypes are list in a private header file called <code>__arm_2d_direct.h</code>.</p>
<p >You can override the default C implementation by using the keyword <code>__OVERRIDE_WEAK</code>, for example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __ARM_2D_IMPL__     </span><span class="comment">/* it is important to define this macro in the begining of your C source file */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;__arm_2d_impl.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_sync_acc_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* some code to initialize the hardware logic if required */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__gKernel.html#gaf675320d8afdd3d72e951d1a5eb9fcd1" title="an decoration for claiming that the immediate following symbol (variable / function) is not WEAK....">__OVERRIDE_WEAK</a></div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_impl_rgb565_src_msk_copy(uint16_t * __restrict pSourceBase,</div>
<div class="line">                                       int16_t iSourceStride,</div>
<div class="line">                                       uint8_t * __restrict ptSourceMaskBase,</div>
<div class="line">                                       int16_t iSourceMaskStride,</div>
<div class="line">                                       <a class="code hl_struct" href="group__gKernel.html#structarm__2d__size__t" title="a type for the size of an rectangular area">arm_2d_size_t</a> *</div>
<div class="line">                                       __restrict ptSourceMaskSize,</div>
<div class="line">                                       uint16_t * __restrict pTargetBase,</div>
<div class="line">                                       int16_t iTargetStride,</div>
<div class="line">                                       <a class="code hl_struct" href="group__gKernel.html#structarm__2d__size__t" title="a type for the size of an rectangular area">arm_2d_size_t</a> * __restrict ptCopySize)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* your own implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p >This example code overrides the low-level implementation of <b>tile-copy-with-src-mask-only for rgb565</b>.</p>
<h2><a class="anchor" id="autotoc_md139"></a>
1.3 Insert An User Defined Header File</h2>
<p >If you defined the macro <code>__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</code> to <code>1</code>, an user defined header file <code>arm_2d_user_sync_acc.h</code> will be included in compilation, as shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if defined(__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__) &amp;&amp; __ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</span></div>
<div class="line"><span class="preprocessor">#   include &quot;arm_2d_user_sync_acc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p >You can use this header file to</p>
<ul>
<li>Override Arm-2D intrinsics and</li>
<li>Provide related information if required, such as function prototypes, variables definitions, user defined types, macros etc.</li>
</ul>
<blockquote class="doxtable">
<p ><b>NOTE</b>:</p>
<ol type="1">
<li>The macro <code>__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</code> does NOT affect the overriding of Arm-2D intrinsics.</li>
<li>It is NOT necessary but recommended to use <code>arm_2d_user_sync_acc.h</code> to override the Arm-2D intrinsics as long as you have other viable solutions (for example, use <code>-D</code> command line option in GCC, LLVM and Arm Compiler 6 )</li>
<li>It is NOT necessary but recommanded to use macro <code>__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</code> to include the header file <code>arm_2d_user_sync_acc.h</code> as long as you have other viable solutions (for example, use <code>-include</code> command line option in GCC, LLVM and Arm Compiler 6 ). </li>
</ol>
</blockquote>
<p >After setting the macro <code>__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</code> to <code>1</code>, <code>arm_2d.c</code> will call the <code>__arm_2d_sync_acc_init()</code> that you <b>MUST</b> implement in your own c source file. You can initialize the acceleration hardware logic here. If there is nothing to initialize, please place an empty function body in your c source code.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">#<span class="keywordflow">if</span> !defined(<a class="code hl_define" href="group__gKernel.html#ga25908e166b33d5f00cf5824a4a32f30f" title="target MCU has no tightly coupled acceleration (other than ACI)">__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</a>) || !<a class="code hl_define" href="group__gKernel.html#ga25908e166b33d5f00cf5824a4a32f30f" title="target MCU has no tightly coupled acceleration (other than ACI)">__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</a></div>
<div class="line"><span class="preprocessor">#   define __arm_2d_sync_acc_init()</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">#<span class="keywordflow">if</span> defined(<a class="code hl_define" href="group__gKernel.html#ga25908e166b33d5f00cf5824a4a32f30f" title="target MCU has no tightly coupled acceleration (other than ACI)">__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</a>) &amp;&amp; <a class="code hl_define" href="group__gKernel.html#ga25908e166b33d5f00cf5824a4a32f30f" title="target MCU has no tightly coupled acceleration (other than ACI)">__ARM_2D_HAS_TIGHTLY_COUPLED_ACC__</a><span class="comment"></span></div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise the tightly-coupled (sync) acceleration</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">extern</span></div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_sync_acc_init(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise arm-2d</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">void <a class="code hl_function" href="group__gKernel.html#gae417897e7d7186b294c0ff3468102276" title="initialise arm-2d">arm_2d_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    __arm_2d_init();      </div>
<div class="line">    </div>
<div class="line">    ...</div>
<div class="line">    __arm_2d_sync_acc_init();                                             </div>
<div class="line">    ...                                              </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md140"></a>
2 Asynchronouse Acceleration</h1>
<h2><a class="anchor" id="autotoc_md141"></a>
2.1 Pixel Pipeline Overview</h2>
<p >Architectually, Arm-2D is designed as a <b>Pixel-Pipeline</b> plus <b>a set of OPCODE</b>, as shown in <b>Figure 2-1</b>.</p>
<p ><b>Figure 2-1 Arm-2D Pixel-Pipeline</b></p>
<p ><img src="PixelPipeline.png" alt="" class="inline" title="PixelPipeline"/></p>
<p >Here, <b>OPCODE</b> is the descriptor of 2D operations. It contains both <b>the arguments from the caller</b> and <b>the references to the actual algorithms</b> for the specific 2D operation. The <b>User Interface</b> part provides APIs that generate and initialize <b>OPCODE</b>. The <b>Frontend</b> performs some common pre-processing for each OPCODE and generates <b>TASK**s for the **Backend</b>.</p>
<p ><b>TASK</b> is the descriptor of low-level tasks that can be handled by software algorithms and hardware accelerators. The key feature of the Backend is <b>a Fall-back scheme</b>, that <b>the Dispatcher in the Backend will always issue tasks to the HW adaptor</b> (a driver for a corresponding accelerator) <b>and falls back to the software algorithm for tasks refused by the HW adaptor</b>.</p>
<h3><a class="anchor" id="autotoc_md142"></a>
Feature Agnostic</h3>
<p >Arm-2D does not propose a standard for what functionality a hardware accelerator should provide, nor does it set requirements for the characteristics of a hardware accelerator. This is intentional. In order to get the best compatibility and interface flexibility, Arm-2D splits 2D processing into simple small tasks, validates parameters passed to the hardware (e.g. ensuring that the coordinate values are always non-negative, and memory addresses are valid), passes all the task information to the HW adapter, and let the HW adaptor to decide whether the corresponding task can be processed or not. This is the meanning of the <b>Feature Agnostic</b>.</p>
<h2><a class="anchor" id="autotoc_md143"></a>
2.2 OPCODE based Acceleration Entry</h2>
<p >Each <b>OPCODE</b> refers to a dedicated <b>Low-Level-IO</b> that has two function pointers:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <a class="code hl_enumeration" href="group__gKernel.html#ga373f79d09c0d15653ca46ea08e0377fc" title="finite-state-machine status return (Compatible with arm_status, minimal integer: int8_t)">arm_fsm_rt_t</a> __arm_2d_io_func_t(__arm_2d_sub_task_t *ptTask);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_typedef" href="group__gKernel.html#ga5794a4d595906803e2c82088b3e29464" title="an incomplete defintion which is only used for defining pointers">__arm_2d_low_level_io_t</a> {</div>
<div class="line">    __arm_2d_io_func_t *SW;</div>
<div class="line">    __arm_2d_io_func_t *HW;</div>
<div class="line">} <a class="code hl_typedef" href="group__gKernel.html#ga5794a4d595906803e2c82088b3e29464" title="an incomplete defintion which is only used for defining pointers">__arm_2d_low_level_io_t</a>;</div>
</div><!-- fragment --><ul>
<li>Here <code>SW</code> points to a software implementation that <b>won't return until either the 2D operation is complete or some error happens</b>.</li>
<li>Here <code>HW</code> points to the <b>hardware adaptor</b> (a.k.a driver) of a hardware accelerator that can work asynchronously with the caller of the Arm-2D APIs. Based on the arguments passed to the <code>SW</code>, the capability and the status of the 2D accelerator, the <b>hardware adaptor</b> might:<ul>
<li>return <code>ARM_2D_ERR_NOT_SUPPORT</code> if the hardware isn't capable to do what is requested.</li>
<li>return <code>arm_fsm_rt_cpl</code> if the task is done immediately (and no need to wait).</li>
<li>return <code>arm_fsm_rt_async</code> if the task is done asynchronously and the driver will call function <code>__arm_2d_notify_sub_task_cpl()</code> to report the result.</li>
</ul>
</li>
</ul>
<p >Arm-2D provides the default C implementation (and the Helium version when it is available) for each OPCODE.</p>
<div class="fragment"><div class="line"><span class="comment">/*----------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment"> * Low Level IO Interfaces                                                    *</span></div>
<div class="line"><span class="comment"> *----------------------------------------------------------------------------*/</span></div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_COPY_C8BIT, __arm_2d_c8bit_sw_tile_copy);</div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_COPY_RGB16, __arm_2d_rgb16_sw_tile_copy);</div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_COPY_RGB32, __arm_2d_rgb32_sw_tile_copy);</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_FILL_ONLY_C8BIT, __arm_2d_c8bit_sw_tile_fill_only);</div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_FILL_ONLY_RGB16, __arm_2d_rgb16_sw_tile_fill_only);</div>
<div class="line">__WEAK</div>
<div class="line">def_low_lv_io(__ARM_2D_IO_FILL_ONLY_RGB32, __arm_2d_rgb32_sw_tile_fill_only);</div>
<div class="line"> </div>
<div class="line">...</div>
</div><!-- fragment --><p >Here <code>__arm_2d_&lt;colour&gt;_sw_&lt;operation name&gt;</code> are the default software implementations for corresponding <b>Low-Level-IO</b>. The keyword <code>__WEAK</code> indicates that the target IOs can be overridden with user-defined ones. For example, if you want to accelerate <b>copy-with-opacity</b> for RGB565 using your own hardware accelerator, please do the following steps:</p>
<ol type="1">
<li><p class="startli">In one of your C source file, override the target <b>Low-Level-IO</b> <code>__ARM_2D_IO_COPY_WITH_OPACITY_RGB565</code></p>
<div class="fragment"><div class="line"><span class="comment">//! PLEASE add following three lines in your hardware adapter source code</span></div>
<div class="line"><span class="preprocessor">#define __ARM_2D_IMPL__</span></div>
<div class="line"><span class="preprocessor">#include &quot;arm_2d.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;__arm_2d_impl.h&quot;</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">__OVERRIDE_WEAK</div>
<div class="line">def_low_lv_io(  __ARM_2D_IO_COPY_WITH_OPACITY_RGB565,           <span class="comment">/* target Low-Level-IO */</span></div>
<div class="line">                __arm_2d_rgb565_sw_tile_copy_with_opacity,      <span class="comment">/* SW: the default implementation */</span></div>
<div class="line">                __arm_2d_rgb565_my_hw_tile_copy_with_opacity);  <span class="comment">/* HW: the hardware adapter (driver) */</span></div>
</div><!-- fragment --></li>
<li>Copy the function body of <code>__arm_2d_rgb565_sw_tile_copy_with_opacity()</code> to your source file, rename it as <code>__arm_2d_rgb565_my_hw_tile_copy_with_opacity()</code> and use it as a template of the <em><b>hardware adaptor</b></em>.</li>
<li>Update <code>__arm_2d_rgb565_my_hw_tile_copy_with_opacity</code> for the hardware accelerator.</li>
<li>Based on the arguments passed to the function and the capability of your 2D accelerator, please:<ul>
<li>return <code>ARM_2D_ERR_NOT_SUPPORT</code> if the hardware isn't capable to do what is requested.</li>
<li>return <code>arm_fsm_rt_cpl</code> if the task is done immediately and no need to wait.</li>
<li>return <code>arm_fsm_rt_async</code> if the task is done asynchronously and later report to arm-2d by calling function <code>__arm_2d_notify_sub_task_cpl()</code>.</li>
</ul>
</li>
</ol>
<p ><em><b>NOTE</b></em>: As the Arm-2D pipeline will keep issuing tasks to your <em><b>hardware adaptor</b></em>, please quickly check whether the hardware is capable of doing the task:</p>
<ul>
<li>If the <b>hardware adaptor</b> decides to keep it, it can add the task (an <code>__arm_2d_sub_task_t</code> object) to a waiting list in <em><b>First-In-First-Out</b></em> manner, and handle them later.</li>
<li>If the <b>hardware adaptor</b> is busy and don't want to maintain a waiting list, it can return <code>ARM_2D_ERR_NOT_SUPPORT</code> and the task falls-back to the SW implementation.</li>
</ul>
<h2><a class="anchor" id="autotoc_md144"></a>
2.3 Insert An User Defined Header File</h2>
<p >If you defined the macro <code>__ARM_2D_HAS_HW_ACC__</code> to <code>1</code>, an user defined header file <code>arm_2d_user_async_acc.h</code> will be included in compilation, as shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if defined(__ARM_2D_HAS_HW_ACC__) &amp;&amp; __ARM_2D_HAS_HW_ACC__</span></div>
<div class="line"><span class="preprocessor">#   include &quot;arm_2d_user_async_acc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p >You can use this header file to</p>
<ul>
<li>Provide related information if required, such as function prototypes, variables definitions, user defined types, macros etc.</li>
</ul>
<blockquote class="doxtable">
<p ><b>NOTE</b>:</p>
<ol type="1">
<li>The macro <code>__ARM_2D_HAS_HW_ACC__</code> does NOT affect the overriding of Arm-2D intrinsics or overriding the default OPCODEs.</li>
<li>It is NOT necessary but recommended to use <code>arm_2d_user_async_acc.h</code> to override the Arm-2D intrinsics and the default OPCODEs as long as you have other viable solutions (for example, use <code>-D</code> command line option in GCC, LLVM and Arm Compiler 6 )</li>
<li>It is NOT necessary but recommanded to use macro <code>__ARM_2D_HAS_HW_ACC__</code> to include the header file <code>arm_2d_user_async_acc.h</code> as long as you have other viable solutions (for example, use <code>-include</code> command line option in GCC, LLVM and Arm Compiler 6 ). </li>
</ol>
</blockquote>
<p >After setting the macro <code>__ARM_2D_HAS_HW_ACC__</code> to <code>1</code>, <code>arm_2d.c</code> will call the <code>__arm_2d_async_acc_init()</code> that you <b>MUST</b> implement in your own c source file. You can initialize the acceleration hardware logic here. If there is nothing to initialize, please place an empty function body in your c source code.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">#<span class="keywordflow">if</span> defined(<a class="code hl_define" href="group__gKernel.html#gafc15611a43cb4dafc518b4948ab380f8" title="target MCU has no dedicated hardware (async) acceleration">__ARM_2D_HAS_HW_ACC__</a>) &amp;&amp; !<a class="code hl_define" href="group__gKernel.html#gafc15611a43cb4dafc518b4948ab380f8" title="target MCU has no dedicated hardware (async) acceleration">__ARM_2D_HAS_HW_ACC__</a></div>
<div class="line"><span class="preprocessor">#   define __arm_2d_async_acc_init()</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">#<span class="keywordflow">if</span> defined(<a class="code hl_define" href="group__gKernel.html#gafc15611a43cb4dafc518b4948ab380f8" title="target MCU has no dedicated hardware (async) acceleration">__ARM_2D_HAS_HW_ACC__</a>) &amp;&amp; <a class="code hl_define" href="group__gKernel.html#gafc15611a43cb4dafc518b4948ab380f8" title="target MCU has no dedicated hardware (async) acceleration">__ARM_2D_HAS_HW_ACC__</a><span class="comment"></span></div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise the hardware (async) acceleration</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">extern</span></div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_async_acc_init(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise arm-2d</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">void <a class="code hl_function" href="group__gKernel.html#gae417897e7d7186b294c0ff3468102276" title="initialise arm-2d">arm_2d_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    __arm_2d_init();      </div>
<div class="line">    </div>
<div class="line">    ...</div>
<div class="line">    __arm_2d_async_acc_init();                                             </div>
<div class="line">    ...                                              </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md145"></a>
2.4 Software Design Considerations for End Users</h2>
<h3><a class="anchor" id="autotoc_md146"></a>
2.4.1 When and How to Enable Asynchronouse Mode</h3>
<p >Arm-2D APIs can be used in both Synchronous mode and Asynchronous mode. In fact, The Arm-2D library is designed for working asynchronously, and wrappers are added to support synchronous mode.</p>
<h4><a class="anchor" id="autotoc_md147"></a>
Synchronous Mode</h4>
<p >The Synchronous mode is also known as the classic mode, in which a function call won't return until the task is finished or an error occurred.</p>
<h4><a class="anchor" id="autotoc_md148"></a>
Asynchronous Mode</h4>
<p >The Asynchronous mode is good for the event-driven design paradigm, and it is suitable for most of the RTOS based applications and applications that are written in Protothread and/or FSM in the bare-metal system.</p>
<p >Please only enable Asynchronouse mode if and only if:</p>
<ul>
<li>The runtime supports multi-tasks (e.g. RTOS, protoThread and FSM)</li>
<li>The device provides Accelerator(s) that works Asynchronousely with CPU (e.g. a 2D-GPU, a 2D-capable DMA or a dedicated processor)</li>
<li>Hardware Adaptors are implemented for the Accelerator using the method described in Section 2.</li>
</ul>
<p >You can enable the Asynchronouse mode by set the macro <code>__ARM_2D_HAS_ASYNC__</code> to <code>1</code>, the default value is <code>0</code>. You can modify the macro value in <code>arm_2d_cfg.h</code> or define the macro <code>__ARM_2D_HAS_ASYNC__</code> directly in your project, which will override the macro value defined in <code>arm_2d_cfg.h</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef __ARM_2D_USER_CFG_H__</span></div>
<div class="line"><span class="preprocessor">#define __ARM_2D_USER_CFG_H__</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*============================ INCLUDES ======================================*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;RTE_Components.h&quot;</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// &lt;q&gt;Enable Asynchronous Programmers&#39; model support</span></div>
<div class="line"><span class="comment">// &lt;i&gt; Note that if you don&#39;t have any hardware accelerator, disable this feature can reduce code size and gain a small performance uplift.</span></div>
<div class="line"><span class="comment">// &lt;i&gt; This feature is enabled by default.</span></div>
<div class="line">#ifndef <a class="code hl_define" href="group__gKernel.html#ga44b4f0ecafd8d5fb7de9f104d9321998" title="enable asynchronous mode (enable pipeline)">__ARM_2D_HAS_ASYNC__</a></div>
<div class="line"><span class="preprocessor">#   define __ARM_2D_HAS_ASYNC__                                     0</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">#endif </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md149"></a>
2.4.2 How to Manage Dependencies Among 2D Operations</h3>
<h3><a class="anchor" id="autotoc_md150"></a>
2.4.3 Acceleration Methods Preference</h3>
<h1><a class="anchor" id="autotoc_md151"></a>
3 Acceleration via Arm Custom Instruction (ACI)</h1>
<h2><a class="anchor" id="autotoc_md152"></a>
3.1 Helium-based ACI and Non-Helium-based ACI</h2>
<p >A lot of Arm Cortex-M processors support Arm Custom Instruction. When Helium extension is available, chip designers can implement the so-called Helium-based ACI which can use 128bit wide vectors and Helium registers.</p>
<h2><a class="anchor" id="autotoc_md153"></a>
3.2 Disable the default Helium Implementation</h2>
<p >In the <code>Library/Include/template</code> folder, there is a template file for the <code>arm_2d_user_aci.h</code>, please follow the guidance in the <code>DISABLE DEFAULT HELIUM IMPLEMENTATION</code> section to disable the default Helium implementation of the low level functions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if !defined(__ARM_2D_USER_ACI_H__) &amp;&amp; __ARM_2D_HAS_ACI__</span></div>
<div class="line"><span class="preprocessor">#define __ARM_2D_USER_ACI_H__</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*============================ INCLUDES ======================================*/</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * NOTE: You can modify this header file for your ACI acceleration.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*============================ DISABLE DEFAULT HELIUM IMPLEMENTATION =========*/</span></div>
<div class="line"> </div>
<div class="line">#<span class="keywordflow">if</span> defined(__ARM_2D_IMPLEMENT_HELIUM__) &amp;&amp; __ARM_2D_IMPLEMENT_HELIUM__</div>
<div class="line"><span class="comment">/* </span></div>
<div class="line"><span class="comment"> * NOTE: inside this block, you can rename the target low level functions, i.e. </span></div>
<div class="line"><span class="comment"> *       functions with prefix like __arm_2d_impl_xxxxx to a different name,</span></div>
<div class="line"><span class="comment"> *       by doing so, your ACI accelerated low level implementation can override</span></div>
<div class="line"><span class="comment"> *       the defaultC version. </span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *       For example:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *       #define __arm_2d_impl_cccn888_to_rgb565    \</span></div>
<div class="line"><span class="comment"> *                    __arm_2d_impl_cccn888_to_rgb565_origin</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *       by doing so, your own ACI version of __arm_2d_impl_cccn888_to_rgb565 </span></div>
<div class="line"><span class="comment"> *       can override the default WEAK version in arm-2d library.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* end of __ARM_2D_USER_ACI_H__ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p >For example, suppose you want to accelerate <code>__arm_2d_impl_rgb565_src_msk_copy</code> and replace the Helium version with your own ACI accelerated one, then please do the following steps:</p>
<ol type="1">
<li>create a C source file for your own ACI accelerated low level function(s):</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#define __ARM_2D_IMPL__     </span><span class="comment">/* it is important to define this macro in the begining of your C source file */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;__arm_2d_impl.h&quot;</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">void __arm_2d_aci_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* some code to initialize the ACI hardware logic of your device */</span></div>
<div class="line">}</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">__OVERRIDE_WEAK</div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_impl_rgb565_src_msk_copy(uint16_t * __restrict pSourceBase,</div>
<div class="line">                                       int16_t iSourceStride,</div>
<div class="line">                                       uint8_t * __restrict ptSourceMaskBase,</div>
<div class="line">                                       int16_t iSourceMaskStride,</div>
<div class="line">                                       <a class="code hl_struct" href="group__gKernel.html#structarm__2d__size__t" title="a type for the size of an rectangular area">arm_2d_size_t</a> *</div>
<div class="line">                                       __restrict ptSourceMaskSize,</div>
<div class="line">                                       uint16_t * __restrict pTargetBase,</div>
<div class="line">                                       int16_t iTargetStride,</div>
<div class="line">                                       <a class="code hl_struct" href="group__gKernel.html#structarm__2d__size__t" title="a type for the size of an rectangular area">arm_2d_size_t</a> * __restrict ptCopySize)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* your own implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>copy the <code>arm_2d_user_aci.h</code> from the <code>Library/Include/template</code> to your own directory and add the following content:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#if !defined(__ARM_2D_USER_ACI_H__) &amp;&amp; __ARM_2D_HAS_ACI__</span></div>
<div class="line"><span class="preprocessor">#define __ARM_2D_USER_ACI_H__</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">#<span class="keywordflow">if</span> defined(__ARM_2D_IMPLEMENT_HELIUM__) &amp;&amp; __ARM_2D_IMPLEMENT_HELIUM__</div>
<div class="line"><span class="comment">/* </span></div>
<div class="line"><span class="comment"> * NOTE: inside this block, you can rename the target low level functions, i.e. </span></div>
<div class="line"><span class="comment"> *       functions with prefix like __arm_2d_impl_xxxxx to a different name,</span></div>
<div class="line"><span class="comment"> *       by doing so, your ACI accelerated low level implementation can override</span></div>
<div class="line"><span class="comment"> *       the defaultC version. </span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *       For example:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *       #define __arm_2d_impl_cccn888_to_rgb565    \</span></div>
<div class="line"><span class="comment"> *                    __arm_2d_impl_cccn888_to_rgb565_origin</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *       by doing so, your own ACI version of __arm_2d_impl_cccn888_to_rgb565 </span></div>
<div class="line"><span class="comment"> *       can override the default WEAK version in arm-2d library.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __arm_2d_impl_rgb565_src_msk_copy __arm_2d_impl_rgb565_src_msk_copy_origin</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">#endif</div>
</div><!-- fragment --><ol type="1">
<li>define the macro <code>__ARM_2D_HAS_ACI</code> to <code>1</code> for the arm-2d library.</li>
</ol>
<h2><a class="anchor" id="autotoc_md154"></a>
3.3 Insert An User Defined Header File</h2>
<p >If you defined the macro <code>__ARM_2D_HAS_ACI__</code> to <code>1</code>, an user defined header file <code>arm_2d_user_aci.h</code> will be included in compilation, as shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if defined(__ARM_2D_HAS_ACI__) &amp;&amp; __ARM_2D_HAS_ACI__</span></div>
<div class="line"><span class="preprocessor">#   include &quot;arm_2d_user_aci.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p >You can use this header file to</p>
<ul>
<li>Override Arm-2D intrinsics,</li>
<li>Disable the specfied helium implementation, and</li>
<li>Provide related information if required, such as function prototypes, variables definitions, user defined types, macros etc.</li>
</ul>
<p >After setting the macro <code>__ARM_2D_HAS_ACI__</code> to <code>1</code>, <code>arm_2d.c</code> will call the <code>__arm_2d_aci_init()</code> that you <b>MUST</b> implement in your own c source file. You can initialize the ACI logic if required. If there is nothing to initialize, please place an empty function body in your c source code.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">#<span class="keywordflow">if</span> !defined(<a class="code hl_define" href="group__gKernel.html#gaffba2221fe2bc0dce63b975c4256802b" title="target MCU has no ACI implementation">__ARM_2D_HAS_ACI__</a>) || !<a class="code hl_define" href="group__gKernel.html#gaffba2221fe2bc0dce63b975c4256802b" title="target MCU has no ACI implementation">__ARM_2D_HAS_ACI__</a></div>
<div class="line"><span class="preprocessor">#   define __arm_2d_aci_init()</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">#<span class="keywordflow">if</span> defined(<a class="code hl_define" href="group__gKernel.html#gaffba2221fe2bc0dce63b975c4256802b" title="target MCU has no ACI implementation">__ARM_2D_HAS_ACI__</a>) &amp;&amp; <a class="code hl_define" href="group__gKernel.html#gaffba2221fe2bc0dce63b975c4256802b" title="target MCU has no ACI implementation">__ARM_2D_HAS_ACI__</a><span class="comment"></span></div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise the ACI service</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">extern</span></div>
<div class="line"><span class="keywordtype">void</span> __arm_2d_aci_init(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/*! </span></div>
<div class="line"><span class="comment"> * \brief initialise arm-2d</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">void <a class="code hl_function" href="group__gKernel.html#gae417897e7d7186b294c0ff3468102276" title="initialise arm-2d">arm_2d_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    __arm_2d_init();      </div>
<div class="line">    </div>
<div class="line">    ...</div>
<div class="line">    __arm_2d_aci_init();                                             </div>
<div class="line">    ...                                              </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
